<div class="w-full h-screen bg-gradient-to-br from-slate-900 via-slate-950 to-black text-slate-100 flex flex-col">
    <!-- Header -->
    <header
        class="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-slate-900/40 bg-slate-900/60 border-b border-white/10">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor"
                    class="bi bi-markdown" viewBox="0 0 16 16">
                    <path
                        d="M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z" />
                    <path fill-rule="evenodd"
                        d="M9.146 8.146a.5.5 0 0 1 .708 0L11.5 9.793l1.646-1.647a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 0-.708" />
                    <path fill-rule="evenodd" d="M11.5 5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 1 .5-.5" />
                    <path
                        d="M3.56 11V7.01h.056l1.428 3.239h.774l1.42-3.24h.056V11h1.073V5.001h-1.2l-1.71 3.894h-.039l-1.71-3.894H2.5V11z" />
                </svg>
                <div>
                    <h1 class="text-lg font-semibold tracking-tight">Markdown Studio</h1>
                    <p class="text-xs text-slate-300/70">Edit • Preview • Export PDF</p>
                </div>
            </div>

            @if (exportingPdf()) {
            <div class="pdf-export-overlay">
                <div class="line-spinner">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <span>Generating PDF</span>
            </div>
            } @else {
            <div class="flex items-center gap-2">
                <button (click)="exportPdf()"
                    class="inline-flex items-center gap-2 rounded-lg px-3.5 py-2.5 text-sm font-medium bg-gradient-to-r from-emerald-500 to-cyan-500 text-white shadow-lg shadow-emerald-500/20 hover:shadow-cyan-500/20 focus:outline-none focus:ring-2 focus:ring-emerald-400 active:scale-[0.99] transition">
                    Export PDF
                </button>
            </div>
            }
        </div>
    </header>

    <!-- Main editor and preview -->
    <main class="flex-1 flex overflow-hidden p-[30px]">
        <div #container
            class="relative flex flex-1 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10 bg-white/5 backdrop-blur-xl">
            <!-- Editor Pane -->
            <section class="overflow-auto custom-scrollbar relative" [style.width.%]="leftWidth()">
                <div class="h-full p-4 lg:p-6 flex flex-col relative">
                    <div class="h-full rounded-xl bg-slate-950/40 ring-1 ring-white/10 shadow-inner flex-1 relative">
                        <textarea #editor
                            class="w-full h-full bg-transparent p-4 lg:p-6 text-sm lg:text-[0.95rem] leading-6 text-slate-100 placeholder:text-slate-400 outline-none resize-none font-mono tracking-tight custom-scrollbar"
                            [value]="markdown()" (input)="onInput($event)" (mouseup)="onTextSelect($event)"
                            spellcheck="false" aria-label="Markdown editor">
                        </textarea>

                        @if (showMenu()) {
                        <div [style.top.px]="menuPosition().top" [style.left.px]="menuPosition().left"
                            class="absolute bg-slate-800 text-white rounded-lg shadow-lg p-1 flex gap-1 z-50 flex-wrap max-w-xs">
                            <button (click)="applyFormat('bold')"
                                class="px-2 py-1 hover:bg-slate-700 rounded font-bold">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-bold" viewBox="0 0 16 16">
                                    <path
                                        d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.673zm0 6.788V8.598h1.73c1.217 0 1.88.492 1.88 1.415 0 .943-.643 1.449-1.832 1.449H5.907z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('italic')" class="px-2 py-1 hover:bg-slate-700 rounded italic">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-italic" viewBox="0 0 16 16">
                                    <path
                                        d="M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.06.096 1.128.212 1.005.807L6.57 11.674c-.123.595-.246.71-1.346.806l-.11.52h3.774l.11-.52c-1.06-.095-1.129-.211-1.006-.806z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('code')"
                                class="px-2 py-1 hover:bg-slate-700 rounded">`</button>
                            <button (click)="applyFormat('codeBlock')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-braces" viewBox="0 0 16 16">
                                    <path
                                        d="M2.114 8.063V7.9c1.005-.102 1.497-.615 1.497-1.6V4.503c0-1.094.39-1.538 1.354-1.538h.273V2h-.376C3.25 2 2.49 2.759 2.49 4.352v1.524c0 1.094-.376 1.456-1.49 1.456v1.299c1.114 0 1.49.362 1.49 1.456v1.524c0 1.593.759 2.352 2.372 2.352h.376v-.964h-.273c-.964 0-1.354-.444-1.354-1.538V9.663c0-.984-.492-1.497-1.497-1.6M13.886 7.9v.163c-1.005.103-1.497.616-1.497 1.6v1.798c0 1.094-.39 1.538-1.354 1.538h-.273v.964h.376c1.613 0 2.372-.759 2.372-2.352v-1.524c0-1.094.376-1.456 1.49-1.456V7.332c-1.114 0-1.49-.362-1.49-1.456V4.352C13.51 2.759 12.75 2 11.138 2h-.376v.964h.273c.964 0 1.354.444 1.354 1.538V6.3c0 .984.492 1.497 1.497 1.6" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('underline')"
                                class="px-2 py-1 hover:bg-slate-700 rounded underline">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-underline" viewBox="0 0 16 16">
                                    <path
                                        d="M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 3.917 3.623s3.917-1.518 3.917-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-2.687 2.57s-2.687-1.08-2.687-2.57zM12.5 15h-9v-1h9z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('strikethrough')"
                                class="px-2 py-1 hover:bg-slate-700 rounded line-through">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-strikethrough" viewBox="0 0 16 16">
                                    <path
                                        d="M6.333 5.686c0 .31.083.581.27.814H5.166a2.8 2.8 0 0 1-.099-.76c0-1.627 1.436-2.768 3.48-2.768 1.969 0 3.39 1.175 3.445 2.85h-1.23c-.11-1.08-.964-1.743-2.25-1.743-1.23 0-2.18.602-2.18 1.607zm2.194 7.478c-2.153 0-3.589-1.107-3.705-2.81h1.23c.144 1.06 1.129 1.703 2.544 1.703 1.34 0 2.31-.705 2.31-1.675 0-.827-.547-1.374-1.914-1.675L8.046 8.5H1v-1h14v1h-3.504c.468.437.675.994.675 1.697 0 1.826-1.436 2.967-3.644 2.967" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('link')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-paperclip" viewBox="0 0 16 16">
                                    <path
                                        d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('h1')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-h1" viewBox="0 0 16 16">
                                    <path
                                        d="M7.648 13V3H6.3v4.234H1.348V3H0v10h1.348V8.421H6.3V13zM14 13V3h-1.333l-2.381 1.766V6.12L12.6 4.443h.066V13z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('h2')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-h2" viewBox="0 0 16 16">
                                    <path
                                        d="M7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13zm3.174-7.071v-.05c0-.934.66-1.752 1.801-1.752 1.005 0 1.76.639 1.76 1.651 0 .898-.582 1.58-1.12 2.19l-3.69 4.2V13h6.331v-1.149h-4.458v-.079L13.9 8.786c.919-1.048 1.666-1.874 1.666-3.101C15.565 4.149 14.35 3 12.499 3 10.46 3 9.384 4.393 9.384 5.879v.05z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('h3')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-h3" viewBox="0 0 16 16">
                                    <path
                                        d="M11.07 8.4h1.049c1.174 0 1.99.69 2.004 1.724s-.802 1.786-2.068 1.779c-1.11-.007-1.905-.605-1.99-1.357h-1.21C8.926 11.91 10.116 13 12.028 13c1.99 0 3.439-1.188 3.404-2.87-.028-1.553-1.287-2.221-2.096-2.313v-.07c.724-.127 1.814-.935 1.772-2.293-.035-1.392-1.21-2.468-3.038-2.454-1.927.007-2.94 1.196-2.981 2.426h1.23c.064-.71.732-1.336 1.744-1.336 1.027 0 1.744.64 1.744 1.568.007.95-.738 1.639-1.744 1.639h-.991V8.4ZM7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('h4')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-type-h4" viewBox="0 0 16 16">
                                    <path
                                        d="M13.007 3H15v10h-1.29v-2.051H8.854v-1.18C10.1 7.513 11.586 5.256 13.007 3m-2.82 6.777h3.524v-5.62h-.074a95 95 0 0 0-3.45 5.554zM7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('blockquote')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-quote" viewBox="0 0 16 16">
                                    <path
                                        d="M12 12a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1h-1.388q0-.527.062-1.054.093-.558.31-.992t.559-.683q.34-.279.868-.279V3q-.868 0-1.52.372a3.3 3.3 0 0 0-1.085.992 4.9 4.9 0 0 0-.62 1.458A7.7 7.7 0 0 0 9 7.558V11a1 1 0 0 0 1 1zm-6 0a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1H4.612q0-.527.062-1.054.094-.558.31-.992.217-.434.559-.683.34-.279.868-.279V3q-.868 0-1.52.372a3.3 3.3 0 0 0-1.085.992 4.9 4.9 0 0 0-.62 1.458A7.7 7.7 0 0 0 3 7.558V11a1 1 0 0 0 1 1z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('ul')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-list-task" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z" />
                                    <path
                                        d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z" />
                                    <path fill-rule="evenodd"
                                        d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z" />
                                </svg>
                            </button>
                            <button (click)="applyFormat('ol')" class="px-2 py-1 hover:bg-slate-700 rounded">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-list-ol" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5" />
                                    <path
                                        d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635z" />
                                </svg>
                            </button>
                        </div>
                        }


                    </div>
                </div>
            </section>

            <!-- Divider -->
            <div class="group w-1 relative cursor-col-resize select-none" (mousedown)="startDrag($event)"
                (touchstart)="startDrag($event)">
                <div class="absolute inset-y-6 left-0 right-0"></div>
                <div
                    class="absolute top-1/2 -translate-y-1/2 right-[-12px] hidden md:flex items-center justify-center h-9 w-9 rounded-full bg-slate-900/70 ring-1 ring-white/10 shadow-xl group-hover:scale-105 transition">
                    <div class="h-5 w-1.5 rounded-full bg-white/70"></div>
                </div>
            </div>

            <!-- Preview Pane -->
            <section class="overflow-auto custom-scrollbar" [style.width.%]="100 - leftWidth()">
                <div class="h-full p-4 lg:p-6 flex flex-col">
                    <article #preview
                        class="prose prose-invert max-w-none prose-pre:!bg-slate-900/70 prose-pre:!backdrop-blur prose-pre:!ring-1 prose-pre:!ring-white/10 prose-code:before:content-[''] prose-code:after:content-[''] flex-1"
                        [innerHTML]="renderedHtml()"></article>
                </div>
            </section>
        </div>
    </main>
</div>