<div class="w-full h-screen flex flex-col transition-colors duration-500" [class.bg-gradient-to-br]="theme() === 'dark'"
    [class.from-slate-900]="theme() === 'dark'" [class.via-slate-950]="theme() === 'dark'"
    [class.to-black]="theme() === 'dark'" [class.text-slate-100]="theme() === 'dark'"
    [class.bg-white]="theme() === 'light'" [class.text-slate-900]="theme() === 'light'">
    <!-- Header -->
    <header
        class="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-slate-900/40 bg-slate-900/60 border-b border-white/10">
        <div class="mx-auto max-w-10xl px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor"
                    class="bi bi-markdown" viewBox="0 0 16 16">
                    <path
                        d="M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z" />
                    <path fill-rule="evenodd"
                        d="M9.146 8.146a.5.5 0 0 1 .708 0L11.5 9.793l1.646-1.647a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 0-.708" />
                    <path fill-rule="evenodd" d="M11.5 5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 1 .5-.5" />
                    <path
                        d="M3.56 11V7.01h.056l1.428 3.239h.774l1.42-3.24h.056V11h1.073V5.001h-1.2l-1.71 3.894h-.039l-1.71-3.894H2.5V11z" />
                </svg>
                <div>
                    <h1 class="text-lg font-semibold tracking-tight">Markdown Studio</h1>
                    <p class="text-xs text-slate-300/70">Edit • Preview • Export PDF</p>
                </div>
            </div>

            @if (exportingPdf()) {
            <div class="pdf-export-overlay">
                <div class="line-spinner">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            } @else {
            <div class="flex items-center gap-2">
                <button (click)="exportPdf()" class="relative inline-flex items-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold 
                           text-white bg-gradient-to-r from-emerald-500/80 to-cyan-500/80 
                           backdrop-blur-md border border-white/20
                           shadow-lg shadow-emerald-500/20 
                           transition-all duration-300 
                           hover:from-emerald-400/90 hover:to-cyan-400/90 
                           hover:shadow-cyan-500/30 hover:scale-[1.03] 
                           active:scale-[0.97] group overflow-hidden">

                    <!-- Gradient Shine Animation -->
                    <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent 
                                 -translate-x-full group-hover:translate-x-full 
                                 transition-transform duration-700 ease-in-out">
                    </span>

                    <!-- Icon (export/download) -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4v12m0 0l-4-4m4 4l4-4M4 16h16" />
                    </svg>

                    <span>Export PDF</span>
                </button>

                <button (click)="toggleTheme()" class="relative inline-flex items-center gap-2 rounded-xl px-4 py-2.5 text-sm font-semibold
                         text-white bg-gradient-to-r from-indigo-500/80 to-pink-500/80
                         backdrop-blur-md
                         shadow-lg shadow-indigo-500/20
                         transition-all duration-300
                         hover:from-indigo-400/90 hover:to-pink-400/90
                         hover:shadow-pink-500/30 hover:scale-[1.03] 
                         active:scale-[0.97] group overflow-hidden">

                    <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent 
                                   -translate-x-full group-hover:translate-x-full 
                                   transition-transform duration-700 ease-in-out">
                    </span>

                    <!-- Icon changes based on theme -->
                    @if (theme() === 'dark') {
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-lightbulb-off-fill" viewBox="0 0 16 16">
                        <path
                            d="M2 6c0-.572.08-1.125.23-1.65l8.558 8.559A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m10.303 4.181L3.818 1.697a6 6 0 0 1 8.484 8.484zM5 14.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5M2.354 1.646a.5.5 0 1 0-.708.708l12 12a.5.5 0 0 0 .708-.708z" />
                    </svg>
                    }

                    @if (theme() === 'light') {
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        class="bi bi-lightbulb-fill" viewBox="0 0 16 16">
                        <path
                            d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m3 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5" />
                    </svg>
                    }

                    <span>{{ theme() === 'dark' ? 'Light Mode' : 'Dark Mode' }}</span>
                </button>

            </div>

            }
        </div>
    </header>

    <!-- Main editor and preview -->
    <main class="flex-1 flex overflow-hidden p-[30px]">
        <div #container
            class="relative flex flex-1 rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/10 bg-white/5 backdrop-blur-xl">
            <!-- Editor Pane -->
            <section class="overflow-auto custom-scrollbar relative" [style.width.%]="leftWidth()">
                <div class="h-full p-4 lg:p-6 flex flex-col relative">
                    <div class="h-full bg-slate-950/40 ring-1 ring-white/10 shadow-inner flex-1 relative">
                        <div class="bg-slate-800 text-white shadow-lg p-[15px] flex gap-2 z-50 flex-wrap w-auto">
                            @for (btn of formatButtons; track btn.command) {
                            <button [title]="btn.title" (click)="applyFormat(btn.command)"
                                class="px-2 py-1 rounded transition-colors"
                                [class.bg-white]="activeFormats.has(btn.command)"
                                [class.text-black]="activeFormats.has(btn.command)"
                                [class.hover\:bg-slate-700]="!activeFormats.has(btn.command)" [innerHTML]="btn.icon">
                            </button>
                            }
                        </div>


                        <textarea #editor
                            class="w-full h-full bg-transparent p-4 lg:p-6 text-sm lg:text-[0.95rem] leading-6 text-slate-100 placeholder:text-slate-400 outline-none resize-none font-mono tracking-tight custom-scrollbar"
                            [class.text-slate-100]="theme() === 'dark'" [class.text-slate-900]="theme() === 'light'"
                            [class.bg-transparent]="theme() === 'dark'" [class.bg-gray-50]="theme() === 'light'"
                            [value]="markdown()" (input)="onInput($event)" (mouseup)="onTextSelect($event)"
                            spellcheck="false" aria-label="Markdown editor">
                        </textarea>

                        @if (showMenu()) {
                        <div [style.top.px]="menuPosition().top" [style.left.px]="menuPosition().left"
                            class="absolute bg-slate-800 text-white rounded-lg shadow-lg p-1 flex gap-1 z-50 flex-wrap max-w-xs">
                            @for (btn of formatButtons; track btn.command) {
                            <button [title]="btn.title" (click)="applyFormat(btn.command)"
                                class="px-2 py-1 rounded transition-colors"
                                [class.bg-white]="activeFormats.has(btn.command)"
                                [class.text-black]="activeFormats.has(btn.command)"
                                [class.hover\:bg-slate-700]="!activeFormats.has(btn.command)" [innerHTML]="btn.icon">
                            </button>
                            }
                        </div>
                        }
                    </div>
                </div>
            </section>

            <!-- Divider -->
            <div class="group w-1 relative cursor-col-resize select-none" (mousedown)="startDrag($event)"
                (touchstart)="startDrag($event)">
                <div class="absolute inset-y-6 left-0 right-0"></div>
                <div
                    class="absolute top-1/2 -translate-y-1/2 right-[-12px] hidden md:flex items-center justify-center h-9 w-9 rounded-full bg-slate-900/70 ring-1 ring-white/10 shadow-xl group-hover:scale-105 transition">
                    <div class="h-5 w-1.5 rounded-full bg-white/70"></div>
                </div>
            </div>

            <!-- Preview Pane -->
            <section class="overflow-auto custom-scrollbar" [style.width.%]="100 - leftWidth()">
                <div class="h-full p-4 lg:p-6 flex flex-col">
                    <article #preview [class.prose-invert]="theme() === 'dark'"
                        class="prose prose-invert max-w-none prose-pre:!bg-slate-900/70 prose-pre:!backdrop-blur prose-pre:!ring-1 prose-pre:!ring-white/10 prose-code:before:content-[''] prose-code:after:content-[''] flex-1"
                        [innerHTML]="renderedHtml()"></article>
                </div>
            </section>
        </div>
    </main>
</div>